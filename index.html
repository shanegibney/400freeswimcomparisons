<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <style>
    body {
      margin: 0px;
      padding: 0px;
    }

    canvas {
      border: 2px solid #000000;
    }
  </style>
  <title>Document</title>
</head>

<body>
  <canvas id="myCanvas" width="700" height="500"></canvas>
  <script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');;
    var data = [{
      distance: 400,
      stroke: 'free',
      pool: ['sc', 'sc', 'lc', 'lc', 'sc', 'lc', 'lc', 'lc', 'lc', 'lc'],
      competition: ['Ulster Masters', 'Tralee Masters', 'British Masters', 'Cardiff', 'Munster Masters', 'Limerick', 'Zurich', 'Cardiff', 'Manchester', 'Limerick'],
      date: ['17-4-16', '9-4-16', '20-6-10', '8-5-10', '27-3-10', '6-3-10', '21-8-09', '19-6-09', '20-6-08', '6-3-04']
    }, {
      50: '33.94',
      100: '1:11.08',
      150: '1:49.75',
      200: '2:29.24',
      250: '3:07.94',
      300: '3:46.55',
      350: '4:24.70',
      400: '5:01.18'
    }, {
      50: '34.81',
      100: '1:12.61',
      150: '1:51.55',
      200: '2:30.67',
      250: '3:09.70',
      300: '3:48.56',
      350: '4:26.60',
      400: '5:04.30'
    }, {
      50: '31.87',
      100: '1:06.25',
      150: '1:42.28',
      200: '2:19.75',
      250: '2:57.29',
      300: '3:35.38',
      350: '4:15.36',
      400: '4:56.07'
    }, {
      50: '33.28',
      100: '1:09.58',
      150: '1:46.44',
      200: '2:23.83',
      250: '3:00.82',
      300: '3:38.54',
      350: '4:14.56',
      400: '4:50.91'
    }, {
      50: '31.9',
      100: '1:06.37',
      150: '1:41.95',
      200: '2:17.55',
      250: '2:55.61',
      300: '3:29.67',
      350: '4:07.50',
      400: '4:45.34'
    }, {
      50: '33.11',
      100: '1:09.31',
      150: '1:46.91',
      200: '2:24.51',
      250: '3:01.04',
      300: '3:39.29',
      350: '4:16.05',
      400: '4:52.22'
    }, {
      50: '30.97',
      100: '1:04.89',
      150: '1:41.34',
      200: '2:17.91',
      250: '2:55.69',
      300: '3:33.17',
      350: '4:11.95',
      400: '4:49.24'
    }, {
      50: '34.81',
      100: '1:12.85',
      150: '1:50.96',
      200: '2:29.45',
      250: '3:06.04',
      300: '3:43.58',
      350: '4:20.70',
      400: '4:57.29'
    }, {
      50: '32.95',
      100: '1:09.33',
      150: '1:47.30',
      200: '2:25.59',
      250: '3:03.76',
      300: '3:41.33',
      350: '4:19.66',
      400: '4:56.26'
    }, {
      50: '32.16',
      100: '1:09.05',
      150: '1:45.75',
      200: '2:23.44',
      250: '3:00.39',
      300: '3:36.53',
      350: '4:12.02',
      400: '4:45.40'
    }];
    var yDivision = (canvas.height - 200) / (data.length - 1);

    function mouseMoveListener(evt) {
      mouse = getMousePosition(evt);

      for (var i = 1; i < data.length; i++) {
        for (var item in data[i]) {
          y = canvas.height - 100 - i * yDivision
          index = data[i][item].indexOf(":");
          var seconds;
          if (index != -1) {
            seconds = parseFloat(data[i][item].slice(2, data[i][item].length));
            seconds += 60 * parseFloat(data[i][item][0]);
          } else {
            seconds = parseFloat(data[i][item]);
          }
          if (Math.pow((seconds + xoffset - mouse.x), 2) + Math.pow((y - mouse.y), 2) < Math.pow(10, 2)) {
            context.beginPath();
            context.clearRect(100, 0, 400, 60);
            context.fillStyle = 'black';
            context.fill();
            context.font = 'italic 20pt Calibri';
            context.fillText(data[0]['competition'][i - 1] + ' ' + data[0]['date'][i - 1], 150, 30);
            context.fillText(item + 'm split, ' + data[i][item], 150, 55);
            context.stroke();
            index = false;
          }
        }
        // if (index == -1) {
        //   seconds = parseFloat(data[i][item].slice(2, data[i][item].length));
        //   seconds += 60 * parseFloat(data[i][item][0]);
        //   parseFloat(data[i][item]);
        //   if (Math.pow((seconds + xoffset - mouse.x), 2) + Math.pow((y - mouse.y), 2) < Math.pow(10, 2)) {
        //     console.log('on shape');
        //
        //     context.beginPath();
        //     context.clearRect(100, 0, 400, 55);
        //     context.fillStyle = 'black';
        //     context.fill();
        //     context.font = 'italic 20pt Calibri';
        //     context.fillText(data[0]['competition'][i - 1] + ' ' + data[0]['date'][i - 1], 150, 30);
        //     context.fillText(item + 'm split, ' + data[i][item], 150, 55);
        //     context.stroke();
        //     index = false;
        //   }
        // }
      }
    }

    function graph() {
      for (var i = 1; i < data.length; i++) {
        for (var item in data[i]) {
          xoffset = 100;
          y = canvas.height - 100 - i * yDivision
          index = data[i][item].indexOf(":");
          if (index != -1) {
            seconds = parseFloat(data[i][item].slice(2, data[i][item].length));
            seconds += 60 * parseFloat(data[i][item][0]);
            context.beginPath();
            context.arc(seconds + xoffset, y, 5, 0, 2 * Math.PI);
            if (data[0]['pool'][i - 1] == 'sc') {
              context.fillStyle = 'red';
              context.fill();
            }
            if (data[0]['pool'][i - 1] == 'lc') {
              context.fillStyle = 'blue';
              context.fill();
            }
            context.font = 'italic 10pt Calibri';
            context.fillText(data[0]['competition'][i - 1], 5, y);
            context.fillText(data[0]['date'][i - 1], 5, y + 15);
            context.stroke();
            index = false;
          }
          if (index == -1) {
            context.beginPath();
            x = parseFloat(data[i][item]);
            context.arc(x + xoffset, y, 5, 0, 2 * Math.PI);
            if (data[0]['pool'][i - 1] == 'sc') {
              context.fillStyle = 'red';
              context.fill();
            }
            if (data[0]['pool'][i - 1] == 'lc') {
              context.fillStyle = 'blue';
              context.fill();
            }
            context.stroke();
            index = false;
          }
        }
      }
    }

    function connect() {
      for (var i = 1; i + 1 < data.length; i++) {
        for (var item in data[i]) {
          index = data[i][item].indexOf(":");
          if (index != -1) {
            seconds = parseFloat(data[i][item].slice(2, data[i][item].length));
            seconds += 60 * parseFloat(data[i][item][0]);
            context.beginPath();
            context.lineWidth = 3;
            context.moveTo(seconds + 100, canvas.height - 100 - i * yDivision);
            seconds = parseFloat(data[i + 1][item].slice(2, data[i + 1][item].length));
            seconds += 60 * parseFloat(data[i + 1][item][0]);
            context.lineTo(seconds + 100, canvas.height - 100 - (i + 1) * yDivision);
            context.stroke();
          }
          if (index == -1) {
            context.beginPath();
            context.lineWidth = 3;
            x = parseFloat(data[i][item]);
            context.moveTo(x + 100, canvas.height - 100 - i * yDivision);
            x = parseFloat(data[i + 1][item]);
            context.lineTo(x + 100, canvas.height - 100 - (i + 1) * yDivision);
            context.stroke();
          }
        }
        // }
      }
    }

    function start() {
      // draw axes
      context.beginPath();
      context.moveTo(100, 80);
      context.lineTo(100, canvas.height - 100);
      context.lineTo(canvas.width - 100, canvas.height - 100);
      context.stroke();
      for (var i = 1; i < 11; i++) {
        context.beginPath();
        context.moveTo(100 + 30 * i, canvas.height - 90);
        context.lineTo(100 + 30 * i, 80);
        var time;
        if (i % 2 == 0) {
          time = i / 2 + ':00';
        } else {
          time = (i / 2 - 0.5 + ':30');
        }
        y = canvas.height - 50;
        x = 100 + 30 * i;
        context.translate(x, y);
        context.rotate(-Math.PI / 2);
        context.fillText(time, 0, 0);
        context.rotate(Math.PI / 2);
        context.translate(-x, -y);
        context.stroke();
      }
    }

    function getMousePosition(evt) {
      mouseX = evt.clientX - canvas.offsetLeft;
      mouseY = evt.clientY - canvas.offsetTop;
      mouse = {
        x: mouseX,
        y: mouseY
      };
      return mouse;
    }

    start();
    connect();
    graph();
    window.addEventListener('mousemove', mouseMoveListener, false);
  </script>
</body>

</html>
